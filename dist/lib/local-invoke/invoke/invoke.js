'use strict';var a31_0x73b2=['../../devs','showDebugIdeTipsForVscode','codeMount','functionName','1zlfcws','showDebugIdeTipsForPycharm','region','tmpDirMount','pop','trys','resolveTmpDirToMount','prototype','default','call','sent','pullFcImageIfNeed','sessionId','codeUri','defineProperty','debuggerPath','done','triggerConfig','378424bwbjgL','temp-dir','debugIde','340359aGZnMs','customContainerConfig','push','serviceConfig','nasBaseDir','nasMounts','length','isDockerToolBoxAndEnsureDockerVersion','uuid','genStateId','name','iterator','ensureDir','cleanUnzippedCodeDir','init','resolveRuntimeToDockerImage','resolveCodeUriToMount','compact','log','creds','isCustomContainerRuntime','beforeInvoke','label','isEmpty','function','return','transformMountsForToolbox','9AdOAAL','afterInvoke','ops','toLowerCase','image','nasConfig','baseDir','resolvePasswdMount','clean\x20tmp\x20code\x20dir\x20','__setModuleDefault','containerName','debuggerMount','functionConfig','join','__spreadArrays','showDebugIdeTips','debugPort','Source','tmpDir','getState','255530KFvLYa','mounts','extract-zip','throw','next','5261GVWyhl','297694xMMuFY','../../../common/logger','path','AccountID','227bDBoCl','serviceName','sync','then','dockerUser','__awaiter','../../utils/runtime','runtime','create','docker\x20mounts:\x20','29359GXvsmW','DEFAULT_NAS_PATH_SUFFIX','endsWith','\x20successfully','__esModule','value','1rAIbMD','23XVOyKd','../../docker/docker','74qZeaQR','imageName','.zip','unzippedCodeDir','__importDefault','resolveNasConfigToMounts'];function a31_0x24f7(_0x46b7fa,_0x563787){return a31_0x24f7=function(_0x73b2f4,_0x24f7bf){_0x73b2f4=_0x73b2f4-0x132;var _0x13bafa=a31_0x73b2[_0x73b2f4];return _0x13bafa;},a31_0x24f7(_0x46b7fa,_0x563787);}var a31_0xd8c032=a31_0x24f7;(function(_0x2e4b0b,_0x580fb9){var _0x1c548f=a31_0x24f7;while(!![]){try{var _0x5e76c7=-parseInt(_0x1c548f(0x181))+-parseInt(_0x1c548f(0x184))*parseInt(_0x1c548f(0x16f))+parseInt(_0x1c548f(0x14e))*parseInt(_0x1c548f(0x162))+-parseInt(_0x1c548f(0x152))*parseInt(_0x1c548f(0x165))+parseInt(_0x1c548f(0x148))+parseInt(_0x1c548f(0x163))*parseInt(_0x1c548f(0x14d))+-parseInt(_0x1c548f(0x15c))*-parseInt(_0x1c548f(0x134));if(_0x5e76c7===_0x580fb9)break;else _0x2e4b0b['push'](_0x2e4b0b['shift']());}catch(_0x15c828){_0x2e4b0b['push'](_0x2e4b0b['shift']());}}}(a31_0x73b2,0x3187d));var __createBinding=this&&this['__createBinding']||(Object[a31_0xd8c032(0x15a)]?function(_0x4d8ba2,_0x572630,_0x10c24b,_0x1df064){var _0x204542=a31_0xd8c032;if(_0x1df064===undefined)_0x1df064=_0x10c24b;Object[_0x204542(0x17d)](_0x4d8ba2,_0x1df064,{'enumerable':!![],'get':function(){return _0x572630[_0x10c24b];}});}:function(_0x6cbab8,_0x1b4bf4,_0xabe138,_0xfd29b6){if(_0xfd29b6===undefined)_0xfd29b6=_0xabe138;_0x6cbab8[_0xfd29b6]=_0x1b4bf4[_0xabe138];}),__setModuleDefault=this&&this[a31_0xd8c032(0x13d)]||(Object[a31_0xd8c032(0x15a)]?function(_0x1b5f0f,_0x54bcd1){var _0x4841c4=a31_0xd8c032;Object[_0x4841c4(0x17d)](_0x1b5f0f,_0x4841c4(0x177),{'enumerable':!![],'value':_0x54bcd1});}:function(_0x2fa77a,_0x692f03){_0x2fa77a['default']=_0x692f03;}),__importStar=this&&this['__importStar']||function(_0x1e8965){var _0x23ce3a=a31_0xd8c032;if(_0x1e8965&&_0x1e8965[_0x23ce3a(0x160)])return _0x1e8965;var _0x5f3e5c={};if(_0x1e8965!=null){for(var _0x33c3fd in _0x1e8965)if(_0x33c3fd!=='default'&&Object['hasOwnProperty'][_0x23ce3a(0x178)](_0x1e8965,_0x33c3fd))__createBinding(_0x5f3e5c,_0x1e8965,_0x33c3fd);}return __setModuleDefault(_0x5f3e5c,_0x1e8965),_0x5f3e5c;},__awaiter=this&&this[a31_0xd8c032(0x157)]||function(_0x1f32fc,_0x22fef4,_0x2ef3b9,_0x3c99c1){function _0x540883(_0xcb308e){return _0xcb308e instanceof _0x2ef3b9?_0xcb308e:new _0x2ef3b9(function(_0x1d984a){_0x1d984a(_0xcb308e);});}return new(_0x2ef3b9||(_0x2ef3b9=Promise))(function(_0x32e2ab,_0x4247a2){var _0x3f53ee=a31_0x24f7;function _0x45f11c(_0x373257){var _0x114ba5=a31_0x24f7;try{_0x40a283(_0x3c99c1[_0x114ba5(0x14c)](_0x373257));}catch(_0x1afe9b){_0x4247a2(_0x1afe9b);}}function _0xe422b1(_0x490645){var _0x19047e=a31_0x24f7;try{_0x40a283(_0x3c99c1[_0x19047e(0x14b)](_0x490645));}catch(_0x3bc512){_0x4247a2(_0x3bc512);}}function _0x40a283(_0x5c6368){var _0x355179=a31_0x24f7;_0x5c6368[_0x355179(0x17f)]?_0x32e2ab(_0x5c6368['value']):_0x540883(_0x5c6368[_0x355179(0x161)])[_0x355179(0x155)](_0x45f11c,_0xe422b1);}_0x40a283((_0x3c99c1=_0x3c99c1['apply'](_0x1f32fc,_0x22fef4||[]))[_0x3f53ee(0x14c)]());});},__generator=this&&this['__generator']||function(_0x5cd3b0,_0x2e1d4b){var _0x51d20f=a31_0xd8c032,_0x492fe5={'label':0x0,'sent':function(){if(_0x5ed09b[0x0]&0x1)throw _0x5ed09b[0x1];return _0x5ed09b[0x1];},'trys':[],'ops':[]},_0x52e9cd,_0x342133,_0x5ed09b,_0x162afe;return _0x162afe={'next':_0x1dea62(0x0),'throw':_0x1dea62(0x1),'return':_0x1dea62(0x2)},typeof Symbol===_0x51d20f(0x19c)&&(_0x162afe[Symbol[_0x51d20f(0x18f)]]=function(){return this;}),_0x162afe;function _0x1dea62(_0x436dc1){return function(_0x1838e0){return _0x44fe55([_0x436dc1,_0x1838e0]);};}function _0x44fe55(_0x1d03ba){var _0xfaf2ae=_0x51d20f;if(_0x52e9cd)throw new TypeError('Generator\x20is\x20already\x20executing.');while(_0x492fe5)try{if(_0x52e9cd=0x1,_0x342133&&(_0x5ed09b=_0x1d03ba[0x0]&0x2?_0x342133[_0xfaf2ae(0x132)]:_0x1d03ba[0x0]?_0x342133[_0xfaf2ae(0x14b)]||((_0x5ed09b=_0x342133[_0xfaf2ae(0x132)])&&_0x5ed09b[_0xfaf2ae(0x178)](_0x342133),0x0):_0x342133['next'])&&!(_0x5ed09b=_0x5ed09b['call'](_0x342133,_0x1d03ba[0x1]))[_0xfaf2ae(0x17f)])return _0x5ed09b;if(_0x342133=0x0,_0x5ed09b)_0x1d03ba=[_0x1d03ba[0x0]&0x2,_0x5ed09b[_0xfaf2ae(0x161)]];switch(_0x1d03ba[0x0]){case 0x0:case 0x1:_0x5ed09b=_0x1d03ba;break;case 0x4:_0x492fe5[_0xfaf2ae(0x19a)]++;return{'value':_0x1d03ba[0x1],'done':![]};case 0x5:_0x492fe5[_0xfaf2ae(0x19a)]++,_0x342133=_0x1d03ba[0x1],_0x1d03ba=[0x0];continue;case 0x7:_0x1d03ba=_0x492fe5['ops'][_0xfaf2ae(0x173)](),_0x492fe5[_0xfaf2ae(0x174)][_0xfaf2ae(0x173)]();continue;default:if(!(_0x5ed09b=_0x492fe5[_0xfaf2ae(0x174)],_0x5ed09b=_0x5ed09b[_0xfaf2ae(0x18a)]>0x0&&_0x5ed09b[_0x5ed09b[_0xfaf2ae(0x18a)]-0x1])&&(_0x1d03ba[0x0]===0x6||_0x1d03ba[0x0]===0x2)){_0x492fe5=0x0;continue;}if(_0x1d03ba[0x0]===0x3&&(!_0x5ed09b||_0x1d03ba[0x1]>_0x5ed09b[0x0]&&_0x1d03ba[0x1]<_0x5ed09b[0x3])){_0x492fe5[_0xfaf2ae(0x19a)]=_0x1d03ba[0x1];break;}if(_0x1d03ba[0x0]===0x6&&_0x492fe5[_0xfaf2ae(0x19a)]<_0x5ed09b[0x1]){_0x492fe5['label']=_0x5ed09b[0x1],_0x5ed09b=_0x1d03ba;break;}if(_0x5ed09b&&_0x492fe5[_0xfaf2ae(0x19a)]<_0x5ed09b[0x2]){_0x492fe5[_0xfaf2ae(0x19a)]=_0x5ed09b[0x2],_0x492fe5[_0xfaf2ae(0x136)]['push'](_0x1d03ba);break;}if(_0x5ed09b[0x2])_0x492fe5['ops'][_0xfaf2ae(0x173)]();_0x492fe5[_0xfaf2ae(0x174)]['pop']();continue;}_0x1d03ba=_0x2e1d4b[_0xfaf2ae(0x178)](_0x5cd3b0,_0x492fe5);}catch(_0x56edc9){_0x1d03ba=[0x6,_0x56edc9],_0x342133=0x0;}finally{_0x52e9cd=_0x5ed09b=0x0;}if(_0x1d03ba[0x0]&0x5)throw _0x1d03ba[0x1];return{'value':_0x1d03ba[0x0]?_0x1d03ba[0x1]:void 0x0,'done':!![]};}},__spreadArrays=this&&this[a31_0xd8c032(0x142)]||function(){var _0x5b331a=a31_0xd8c032;for(var _0x41dfb1=0x0,_0x497033=0x0,_0x5cc71f=arguments[_0x5b331a(0x18a)];_0x497033<_0x5cc71f;_0x497033++)_0x41dfb1+=arguments[_0x497033][_0x5b331a(0x18a)];for(var _0x4bb5a5=Array(_0x41dfb1),_0x3d1cd4=0x0,_0x497033=0x0;_0x497033<_0x5cc71f;_0x497033++)for(var _0x73ffd0=arguments[_0x497033],_0x53dd4f=0x0,_0xe1cbfe=_0x73ffd0['length'];_0x53dd4f<_0xe1cbfe;_0x53dd4f++,_0x3d1cd4++)_0x4bb5a5[_0x3d1cd4]=_0x73ffd0[_0x53dd4f];return _0x4bb5a5;},__importDefault=this&&this[a31_0xd8c032(0x169)]||function(_0x46bdf7){var _0x45aafc=a31_0xd8c032;return _0x46bdf7&&_0x46bdf7[_0x45aafc(0x160)]?_0x46bdf7:{'default':_0x46bdf7};};Object[a31_0xd8c032(0x17d)](exports,a31_0xd8c032(0x160),{'value':!![]});var path=__importStar(require(a31_0xd8c032(0x150))),_=__importStar(require('lodash')),docker=__importStar(require(a31_0xd8c032(0x164))),logger_1=__importDefault(require(a31_0xd8c032(0x14f))),dockerOpts=__importStar(require('../../docker/docker-opts')),fs=__importStar(require('fs-extra')),uuid_1=require(a31_0xd8c032(0x18c)),rimraf=__importStar(require('rimraf')),extract_zip_1=__importDefault(require(a31_0xd8c032(0x14a))),tmpDir=__importStar(require(a31_0xd8c032(0x182))),devs_1=require(a31_0xd8c032(0x16b)),runtime_1=require(a31_0xd8c032(0x158)),core=__importStar(require('@serverless-devs/core'));function isZipArchive(_0x5301d2){var _0x22ca43=a31_0xd8c032;return _0x5301d2?_0x5301d2[_0x22ca43(0x15e)](_0x22ca43(0x167))||_0x5301d2[_0x22ca43(0x15e)]('.jar')||_0x5301d2[_0x22ca43(0x15e)]('.war'):![];}function processZipCodeIfNecessary(_0x28c209){return __awaiter(this,void 0x0,void 0x0,function(){var _0x26035f;return __generator(this,function(_0x338909){var _0x4f74e1=a31_0x24f7;switch(_0x338909[_0x4f74e1(0x19a)]){case 0x0:if(!isZipArchive(_0x28c209))return[0x2,null];_0x26035f=path['join'](tmpDir,uuid_1['v4']());return[0x4,fs[_0x4f74e1(0x190)](_0x26035f)];case 0x1:_0x338909['sent'](),logger_1[_0x4f74e1(0x177)][_0x4f74e1(0x196)]('codeUri\x20is\x20a\x20zip\x20format,\x20will\x20unzipping\x20to\x20'+_0x26035f);return[0x4,extract_zip_1[_0x4f74e1(0x177)](_0x28c209,{'dir':_0x26035f})];case 0x2:_0x338909[_0x4f74e1(0x179)]();return[0x2,_0x26035f];}});});}var Invoke=function(){var _0x2c0220=a31_0xd8c032;function _0x320c95(_0xa1e070,_0x486dee,_0xa4aac1,_0x5d87fa,_0x4a6a73,_0x1e3bf7,_0x3edf56,_0x512c78,_0x2e9341,_0x413b02,_0x4494c0,_0xa13dc7,_0x5512a3){var _0x1520be=a31_0x24f7;this[_0x1520be(0x17b)]=_0xa1e070,this[_0x1520be(0x197)]=_0x486dee,this[_0x1520be(0x171)]=_0xa4aac1,this['serviceName']=_0x4a6a73[_0x1520be(0x18e)],this[_0x1520be(0x187)]=_0x4a6a73,this[_0x1520be(0x16e)]=_0x1e3bf7[_0x1520be(0x18e)],this[_0x1520be(0x140)]=_0x1e3bf7,this[_0x1520be(0x180)]=_0x3edf56,this[_0x1520be(0x144)]=_0x512c78,this[_0x1520be(0x183)]=_0x2e9341,this[_0x1520be(0x188)]=_0x5512a3,this[_0x1520be(0x159)]=this[_0x1520be(0x140)]['runtime'],this[_0x1520be(0x13a)]=_0x5d87fa,this[_0x1520be(0x17c)]=this[_0x1520be(0x140)][_0x1520be(0x17c)]?path['resolve'](this[_0x1520be(0x13a)],this['functionConfig'][_0x1520be(0x17c)]):null,this['tmpDir']=_0x413b02,this[_0x1520be(0x17e)]=_0x4494c0,this['debugArgs']=_0xa13dc7;}return _0x320c95['prototype'][_0x2c0220(0x192)]=function(){var _0x5d1549;return __awaiter(this,void 0x0,void 0x0,function(){var _0x50026f,_0x4c7f6c,_0x9105fb,_0xdedfe2,_0x4de238,_0x1740be,_0x26eade,_0x458ccf,_0x296cf8,_0x4c5bae,_0x3e6a01;return __generator(this,function(_0x36895b){var _0x30ff55=a31_0x24f7;switch(_0x36895b['label']){case 0x0:this[_0x30ff55(0x139)]=(_0x5d1549=this['serviceConfig'])===null||_0x5d1549===void 0x0?void 0x0:_0x5d1549['nasConfig'],_0x50026f=this;return[0x4,dockerOpts['resolveDockerUser']({'nasConfig':this[_0x30ff55(0x139)]})];case 0x1:_0x50026f[_0x30ff55(0x156)]=_0x36895b[_0x30ff55(0x179)](),_0x4c7f6c=this;return[0x4,docker[_0x30ff55(0x16a)](this[_0x30ff55(0x13a)],this['serviceName'],this['nasConfig'],this['nasBaseDir']||path[_0x30ff55(0x141)](this['baseDir'],devs_1[_0x30ff55(0x15d)]))];case 0x2:_0x4c7f6c[_0x30ff55(0x189)]=_0x36895b[_0x30ff55(0x179)](),_0x9105fb=this;return[0x4,processZipCodeIfNecessary(this[_0x30ff55(0x17c)])];case 0x3:_0x9105fb['unzippedCodeDir']=_0x36895b[_0x30ff55(0x179)](),_0xdedfe2=this;return[0x4,docker[_0x30ff55(0x194)](this[_0x30ff55(0x168)]||this[_0x30ff55(0x17c)])];case 0x4:_0xdedfe2[_0x30ff55(0x16d)]=_0x36895b[_0x30ff55(0x179)](),_0x4de238=this;return[0x4,docker[_0x30ff55(0x175)](this[_0x30ff55(0x146)])];case 0x5:_0x4de238[_0x30ff55(0x172)]=_0x36895b[_0x30ff55(0x179)](),_0x1740be=this;return[0x4,docker['resolveDebuggerPathToMount'](this[_0x30ff55(0x17e)])];case 0x6:_0x1740be[_0x30ff55(0x13f)]=_0x36895b[_0x30ff55(0x179)](),_0x26eade=this;return[0x4,docker[_0x30ff55(0x13b)]()];case 0x7:_0x26eade['passwdMount']=_0x36895b[_0x30ff55(0x179)](),_0x458ccf=_[_0x30ff55(0x195)](__spreadArrays([this[_0x30ff55(0x16d)]],this[_0x30ff55(0x189)],[this['passwdMount']]));!_[_0x30ff55(0x19b)](this[_0x30ff55(0x172)])&&_0x458ccf[_0x30ff55(0x186)](this[_0x30ff55(0x172)]);!_[_0x30ff55(0x19b)](this[_0x30ff55(0x13f)])&&_0x458ccf[_0x30ff55(0x186)](this[_0x30ff55(0x13f)]);return[0x4,docker[_0x30ff55(0x18b)]()];case 0x8:_0x296cf8=_0x36895b[_0x30ff55(0x179)]();_0x296cf8?this[_0x30ff55(0x149)]=dockerOpts[_0x30ff55(0x133)](_0x458ccf):this[_0x30ff55(0x149)]=_0x458ccf;logger_1[_0x30ff55(0x177)]['debug'](_0x30ff55(0x15b)+JSON['stringify'](this[_0x30ff55(0x149)],null,0x4)),this[_0x30ff55(0x13e)]=docker['generateRamdomContainerName'](),_0x4c5bae=runtime_1[_0x30ff55(0x198)](this[_0x30ff55(0x159)]);if(!_0x4c5bae)return[0x3,0x9];this[_0x30ff55(0x166)]=this[_0x30ff55(0x140)][_0x30ff55(0x185)][_0x30ff55(0x138)];return[0x3,0xb];case 0x9:_0x3e6a01=this;return[0x4,dockerOpts[_0x30ff55(0x193)](this['runtime'])];case 0xa:_0x3e6a01[_0x30ff55(0x166)]=_0x36895b[_0x30ff55(0x179)](),_0x36895b[_0x30ff55(0x19a)]=0xb;case 0xb:return[0x4,docker[_0x30ff55(0x17a)](this[_0x30ff55(0x166)])];case 0xc:_0x36895b[_0x30ff55(0x179)](),this['inited']=!![];return[0x2];}});});},_0x320c95[_0x2c0220(0x176)][_0x2c0220(0x199)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x5e700f){return[0x2];});});},_0x320c95['prototype'][_0x2c0220(0x143)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0xeb0064){var _0x154bc0=a31_0x24f7;switch(_0xeb0064[_0x154bc0(0x19a)]){case 0x0:if(!(this[_0x154bc0(0x144)]&&this['debugIde']))return[0x3,0x4];if(!(this[_0x154bc0(0x183)][_0x154bc0(0x137)]()==='vscode'))return[0x3,0x2];return[0x4,docker[_0x154bc0(0x16c)](this[_0x154bc0(0x153)],this[_0x154bc0(0x16e)],this['runtime'],this[_0x154bc0(0x16d)][_0x154bc0(0x145)],this['debugPort'])];case 0x1:_0xeb0064[_0x154bc0(0x179)]();return[0x3,0x4];case 0x2:if(!(this[_0x154bc0(0x183)][_0x154bc0(0x137)]()==='pycharm'))return[0x3,0x4];return[0x4,docker[_0x154bc0(0x170)](this[_0x154bc0(0x16d)][_0x154bc0(0x145)],this[_0x154bc0(0x144)])];case 0x3:_0xeb0064['sent'](),_0xeb0064[_0x154bc0(0x19a)]=0x4;case 0x4:return[0x2];}});});},_0x320c95[_0x2c0220(0x176)][_0x2c0220(0x191)]=function(){var _0x5b9a34=_0x2c0220;this[_0x5b9a34(0x168)]&&(rimraf[_0x5b9a34(0x154)](this['unzippedCodeDir']),console['log'](_0x5b9a34(0x13c)+this[_0x5b9a34(0x168)]+_0x5b9a34(0x15f)),this[_0x5b9a34(0x168)]=null);},_0x320c95['prototype'][_0x2c0220(0x135)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x12afa1){return this['cleanUnzippedCodeDir'](),[0x2];});});},_0x320c95[_0x2c0220(0x176)][_0x2c0220(0x18d)]=function(){var _0x1f1f6b=_0x2c0220,_0x2539fc,_0x159e05;return this['creds'][_0x1f1f6b(0x151)]+'-'+this['region']+'-'+((_0x2539fc=this[_0x1f1f6b(0x187)])===null||_0x2539fc===void 0x0?void 0x0:_0x2539fc[_0x1f1f6b(0x18e)])+'-'+((_0x159e05=this['functionConfig'])===null||_0x159e05===void 0x0?void 0x0:_0x159e05['name']);},_0x320c95[_0x2c0220(0x176)][_0x2c0220(0x147)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){var _0x1dc797;return __generator(this,function(_0x4a423c){var _0x1fe600=a31_0x24f7;switch(_0x4a423c[_0x1fe600(0x19a)]){case 0x0:_0x1dc797=this[_0x1fe600(0x18d)]();return[0x4,core[_0x1fe600(0x147)](_0x1dc797)];case 0x1:return[0x2,_0x4a423c[_0x1fe600(0x179)]()];}});});},_0x320c95;}();exports['default']=Invoke;