'use strict';var a32_0x3fe5=['594739dABiFs','iterator','__createBinding','resolveTmpDirToMount','trys','Generator\x20is\x20already\x20executing.','__generator','create','log','debuggerMount','resolveDebuggerPathToMount','2dbKCrO','region','sync','temp-dir','fs-extra','741929uQMrCf','image','resolveRuntimeToDockerImage','DISABLE_BIND_MOUNT_TMP_DIR','5315KsGPjC','resolveNasConfigToMounts','isCustomContainerRuntime','path','serviceConfig','functionName','default','length','function','toLowerCase','join','call','compact','unzippedCodeDir','inited','resolveCodeUriToMount','passwdMount','baseDir','1XcZreW','__spreadArrays','../../docker/docker','tmpDirMount','imageName','then','debugPort','.jar','1mbetqE','env','../../utils/utils','next','resolveDockerUser','runtime','sent','afterInvoke','debugArgs','codeMount','name','debuggerPath','debugIde','codeUri\x20is\x20a\x20zip\x20format,\x20will\x20unzipping\x20to\x20','serviceName','done','mounts','value','tmpDir','beforeInvoke','return','writeDebugIdeConfigForVscode','docker\x20mounts:\x20','functionConfig','resolvePasswdMount','label','../../../common/logger','nasConfig','prototype','originalCodeUri','ensureDir','pop','apply','1BhwKir','codeUri','491448UdLiJB','push','resolve','nasBaseDir','transformMountsForToolbox','triggerConfig','.zip','uuid','isDockerToolBoxAndEnsureDockerVersion','DEFAULT_NAS_PATH_SUFFIX','pycharm','isFalseValue','ops','debug','creds','__esModule','init','isEmpty','838351kiSDMX','vscode','lodash','endsWith','nasMounts','\x20successfully','732047OIQRNp','1471626tiIulO','cleanUnzippedCodeDir','customContainerConfig','__awaiter','defineProperty','1YYPGmI','generateRamdomContainerName','../../devs','setDebugIdeConfig'];function a32_0x2612(_0x28c57d,_0x81c293){return a32_0x2612=function(_0x3fe5ef,_0x26124b){_0x3fe5ef=_0x3fe5ef-0x11e;var _0xf856e3=a32_0x3fe5[_0x3fe5ef];return _0xf856e3;},a32_0x2612(_0x28c57d,_0x81c293);}var a32_0x3bb663=a32_0x2612;(function(_0x26d41c,_0x3579ac){var _0x208297=a32_0x2612;while(!![]){try{var _0x2509fe=parseInt(_0x208297(0x173))*-parseInt(_0x208297(0x14f))+-parseInt(_0x208297(0x163))*parseInt(_0x208297(0x16f))+-parseInt(_0x208297(0x183))*-parseInt(_0x208297(0x12e))+parseInt(_0x208297(0x151))+-parseInt(_0x208297(0x126))*parseInt(_0x208297(0x169))+-parseInt(_0x208297(0x187))*parseInt(_0x208297(0x17e))+parseInt(_0x208297(0x16a));if(_0x2509fe===_0x3579ac)break;else _0x26d41c['push'](_0x26d41c['shift']());}catch(_0x4d4c2c){_0x26d41c['push'](_0x26d41c['shift']());}}}(a32_0x3fe5,0x81354));var __createBinding=this&&this[a32_0x3bb663(0x175)]||(Object[a32_0x3bb663(0x17a)]?function(_0x24b698,_0x1d7c94,_0x252550,_0x269595){var _0x4e439c=a32_0x3bb663;if(_0x269595===undefined)_0x269595=_0x252550;Object[_0x4e439c(0x16e)](_0x24b698,_0x269595,{'enumerable':!![],'get':function(){return _0x1d7c94[_0x252550];}});}:function(_0x174b5d,_0x582616,_0x458760,_0x348341){if(_0x348341===undefined)_0x348341=_0x458760;_0x174b5d[_0x348341]=_0x582616[_0x458760];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x427ffa,_0x1dce4f){var _0x159035=a32_0x3bb663;Object[_0x159035(0x16e)](_0x427ffa,'default',{'enumerable':!![],'value':_0x1dce4f});}:function(_0x2a8b19,_0x51572a){var _0x4b3937=a32_0x3bb663;_0x2a8b19[_0x4b3937(0x18d)]=_0x51572a;}),__importStar=this&&this['__importStar']||function(_0x1ffffe){var _0x9bf4b0=a32_0x3bb663;if(_0x1ffffe&&_0x1ffffe[_0x9bf4b0(0x160)])return _0x1ffffe;var _0x216513={};if(_0x1ffffe!=null){for(var _0x2c4dc8 in _0x1ffffe)if(_0x2c4dc8!==_0x9bf4b0(0x18d)&&Object['hasOwnProperty'][_0x9bf4b0(0x11f)](_0x1ffffe,_0x2c4dc8))__createBinding(_0x216513,_0x1ffffe,_0x2c4dc8);}return __setModuleDefault(_0x216513,_0x1ffffe),_0x216513;},__awaiter=this&&this[a32_0x3bb663(0x16d)]||function(_0x1df79d,_0x3c22e9,_0x3df9b9,_0x5834e0){function _0x52297c(_0x26370b){return _0x26370b instanceof _0x3df9b9?_0x26370b:new _0x3df9b9(function(_0x5dc6eb){_0x5dc6eb(_0x26370b);});}return new(_0x3df9b9||(_0x3df9b9=Promise))(function(_0x552b2d,_0x254f77){var _0x2bcd4b=a32_0x2612;function _0x4cd6a3(_0x41dd64){var _0x30b066=a32_0x2612;try{_0x22eb47(_0x5834e0[_0x30b066(0x131)](_0x41dd64));}catch(_0x5ebb05){_0x254f77(_0x5ebb05);}}function _0x3ad30e(_0x526cac){try{_0x22eb47(_0x5834e0['throw'](_0x526cac));}catch(_0x2ca8b8){_0x254f77(_0x2ca8b8);}}function _0x22eb47(_0x3852c1){var _0xefd329=a32_0x2612;_0x3852c1[_0xefd329(0x13d)]?_0x552b2d(_0x3852c1[_0xefd329(0x13f)]):_0x52297c(_0x3852c1['value'])[_0xefd329(0x12b)](_0x4cd6a3,_0x3ad30e);}_0x22eb47((_0x5834e0=_0x5834e0[_0x2bcd4b(0x14e)](_0x1df79d,_0x3c22e9||[]))[_0x2bcd4b(0x131)]());});},__generator=this&&this[a32_0x3bb663(0x179)]||function(_0x550662,_0x382c29){var _0x4a27b3=a32_0x3bb663,_0xd81c82={'label':0x0,'sent':function(){if(_0x17d802[0x0]&0x1)throw _0x17d802[0x1];return _0x17d802[0x1];},'trys':[],'ops':[]},_0x2c2627,_0x34f3f3,_0x17d802,_0x1e0bca;return _0x1e0bca={'next':_0x176e8e(0x0),'throw':_0x176e8e(0x1),'return':_0x176e8e(0x2)},typeof Symbol===_0x4a27b3(0x18f)&&(_0x1e0bca[Symbol[_0x4a27b3(0x174)]]=function(){return this;}),_0x1e0bca;function _0x176e8e(_0x3fbf9f){return function(_0x5431f9){return _0x35bc66([_0x3fbf9f,_0x5431f9]);};}function _0x35bc66(_0x3e2250){var _0xdd8d9c=_0x4a27b3;if(_0x2c2627)throw new TypeError(_0xdd8d9c(0x178));while(_0xd81c82)try{if(_0x2c2627=0x1,_0x34f3f3&&(_0x17d802=_0x3e2250[0x0]&0x2?_0x34f3f3[_0xdd8d9c(0x142)]:_0x3e2250[0x0]?_0x34f3f3['throw']||((_0x17d802=_0x34f3f3[_0xdd8d9c(0x142)])&&_0x17d802[_0xdd8d9c(0x11f)](_0x34f3f3),0x0):_0x34f3f3[_0xdd8d9c(0x131)])&&!(_0x17d802=_0x17d802[_0xdd8d9c(0x11f)](_0x34f3f3,_0x3e2250[0x1]))[_0xdd8d9c(0x13d)])return _0x17d802;if(_0x34f3f3=0x0,_0x17d802)_0x3e2250=[_0x3e2250[0x0]&0x2,_0x17d802[_0xdd8d9c(0x13f)]];switch(_0x3e2250[0x0]){case 0x0:case 0x1:_0x17d802=_0x3e2250;break;case 0x4:_0xd81c82[_0xdd8d9c(0x147)]++;return{'value':_0x3e2250[0x1],'done':![]};case 0x5:_0xd81c82[_0xdd8d9c(0x147)]++,_0x34f3f3=_0x3e2250[0x1],_0x3e2250=[0x0];continue;case 0x7:_0x3e2250=_0xd81c82[_0xdd8d9c(0x15d)][_0xdd8d9c(0x14d)](),_0xd81c82[_0xdd8d9c(0x177)]['pop']();continue;default:if(!(_0x17d802=_0xd81c82[_0xdd8d9c(0x177)],_0x17d802=_0x17d802[_0xdd8d9c(0x18e)]>0x0&&_0x17d802[_0x17d802['length']-0x1])&&(_0x3e2250[0x0]===0x6||_0x3e2250[0x0]===0x2)){_0xd81c82=0x0;continue;}if(_0x3e2250[0x0]===0x3&&(!_0x17d802||_0x3e2250[0x1]>_0x17d802[0x0]&&_0x3e2250[0x1]<_0x17d802[0x3])){_0xd81c82[_0xdd8d9c(0x147)]=_0x3e2250[0x1];break;}if(_0x3e2250[0x0]===0x6&&_0xd81c82['label']<_0x17d802[0x1]){_0xd81c82[_0xdd8d9c(0x147)]=_0x17d802[0x1],_0x17d802=_0x3e2250;break;}if(_0x17d802&&_0xd81c82['label']<_0x17d802[0x2]){_0xd81c82[_0xdd8d9c(0x147)]=_0x17d802[0x2],_0xd81c82[_0xdd8d9c(0x15d)][_0xdd8d9c(0x152)](_0x3e2250);break;}if(_0x17d802[0x2])_0xd81c82[_0xdd8d9c(0x15d)][_0xdd8d9c(0x14d)]();_0xd81c82[_0xdd8d9c(0x177)]['pop']();continue;}_0x3e2250=_0x382c29[_0xdd8d9c(0x11f)](_0x550662,_0xd81c82);}catch(_0x399679){_0x3e2250=[0x6,_0x399679],_0x34f3f3=0x0;}finally{_0x2c2627=_0x17d802=0x0;}if(_0x3e2250[0x0]&0x5)throw _0x3e2250[0x1];return{'value':_0x3e2250[0x0]?_0x3e2250[0x1]:void 0x0,'done':!![]};}},__spreadArrays=this&&this[a32_0x3bb663(0x127)]||function(){var _0x8314f6=a32_0x3bb663;for(var _0x4cb7cd=0x0,_0x352a34=0x0,_0x3cd69f=arguments[_0x8314f6(0x18e)];_0x352a34<_0x3cd69f;_0x352a34++)_0x4cb7cd+=arguments[_0x352a34][_0x8314f6(0x18e)];for(var _0x1d64d9=Array(_0x4cb7cd),_0x91aa92=0x0,_0x352a34=0x0;_0x352a34<_0x3cd69f;_0x352a34++)for(var _0x573e00=arguments[_0x352a34],_0x55323d=0x0,_0x429345=_0x573e00[_0x8314f6(0x18e)];_0x55323d<_0x429345;_0x55323d++,_0x91aa92++)_0x1d64d9[_0x91aa92]=_0x573e00[_0x55323d];return _0x1d64d9;},__importDefault=this&&this['__importDefault']||function(_0x463ec3){var _0x569193=a32_0x3bb663;return _0x463ec3&&_0x463ec3[_0x569193(0x160)]?_0x463ec3:{'default':_0x463ec3};};Object['defineProperty'](exports,a32_0x3bb663(0x160),{'value':!![]});var path=__importStar(require(a32_0x3bb663(0x18a))),_=__importStar(require(a32_0x3bb663(0x165))),docker=__importStar(require(a32_0x3bb663(0x128))),logger_1=__importDefault(require(a32_0x3bb663(0x148))),dockerOpts=__importStar(require('../../docker/docker-opts')),fs=__importStar(require(a32_0x3bb663(0x182))),uuid_1=require(a32_0x3bb663(0x158)),rimraf=__importStar(require('rimraf')),extract_zip_1=__importDefault(require('extract-zip')),tmpDir=__importStar(require(a32_0x3bb663(0x181))),devs_1=require(a32_0x3bb663(0x171)),runtime_1=require('../../utils/runtime'),docker_1=require(a32_0x3bb663(0x128)),utils_1=require(a32_0x3bb663(0x130));function isZipArchive(_0x2c23f3){var _0x1f7c15=a32_0x3bb663;return _0x2c23f3?_0x2c23f3[_0x1f7c15(0x166)](_0x1f7c15(0x157))||_0x2c23f3[_0x1f7c15(0x166)](_0x1f7c15(0x12d))||_0x2c23f3[_0x1f7c15(0x166)]('.war'):![];}function processZipCodeIfNecessary(_0x27e417){return __awaiter(this,void 0x0,void 0x0,function(){var _0x428ac2;return __generator(this,function(_0x2871a9){var _0x789089=a32_0x2612;switch(_0x2871a9[_0x789089(0x147)]){case 0x0:if(!isZipArchive(_0x27e417))return[0x2,null];_0x428ac2=path['join'](tmpDir,uuid_1['v4']());return[0x4,fs[_0x789089(0x14c)](_0x428ac2)];case 0x1:_0x2871a9[_0x789089(0x134)](),logger_1['default'][_0x789089(0x17b)](_0x789089(0x13b)+_0x428ac2);return[0x4,extract_zip_1[_0x789089(0x18d)](_0x27e417,{'dir':_0x428ac2})];case 0x2:_0x2871a9[_0x789089(0x134)]();return[0x2,_0x428ac2];}});});}var Invoke=function(){var _0x4afe7a=a32_0x3bb663;function _0x25a239(_0x58a3d1,_0x5b3e68,_0x1f4b9f,_0x120056,_0x363179,_0x3fd534,_0x44a314,_0x21f377,_0x274e59,_0x20548b,_0x384380,_0x2d63db,_0x3a3a29,_0x272028){var _0x5b79dc=a32_0x2612;this['tunnelService']=_0x58a3d1,this['sessionId']=_0x5b3e68,this[_0x5b79dc(0x15f)]=_0x1f4b9f,this[_0x5b79dc(0x17f)]=_0x120056,this['serviceName']=_0x3fd534[_0x5b79dc(0x138)],this['serviceConfig']=_0x3fd534,this['functionName']=_0x44a314[_0x5b79dc(0x138)],this[_0x5b79dc(0x145)]=_0x44a314,this[_0x5b79dc(0x156)]=_0x21f377,this[_0x5b79dc(0x12c)]=_0x274e59,this[_0x5b79dc(0x13a)]=_0x20548b,this[_0x5b79dc(0x154)]=_0x272028,this[_0x5b79dc(0x133)]=this[_0x5b79dc(0x145)]['runtime'],this[_0x5b79dc(0x125)]=_0x363179,this[_0x5b79dc(0x150)]=this['functionConfig'][_0x5b79dc(0x150)]?path[_0x5b79dc(0x153)](this[_0x5b79dc(0x125)],this[_0x5b79dc(0x145)][_0x5b79dc(0x150)]):null,this[_0x5b79dc(0x140)]=_0x384380,this[_0x5b79dc(0x139)]=_0x2d63db,this[_0x5b79dc(0x136)]=_0x3a3a29;}return _0x25a239[_0x4afe7a(0x14a)][_0x4afe7a(0x161)]=function(){var _0x192e30;return __awaiter(this,void 0x0,void 0x0,function(){var _0x556f4b,_0x1dc35d,_0xb13baf,_0xef5fad,_0x3e4bc4,_0x15e274,_0x58c159,_0x596a72,_0x27b295,_0x3b3ae3,_0xc15bf7,_0x4abf0e;return __generator(this,function(_0x5b2c62){var _0xb4b5cb=a32_0x2612;switch(_0x5b2c62['label']){case 0x0:this[_0xb4b5cb(0x149)]=(_0x192e30=this[_0xb4b5cb(0x18b)])===null||_0x192e30===void 0x0?void 0x0:_0x192e30['nasConfig'],_0x556f4b=this;return[0x4,dockerOpts[_0xb4b5cb(0x132)]({'nasConfig':this[_0xb4b5cb(0x149)]})];case 0x1:_0x556f4b['dockerUser']=_0x5b2c62[_0xb4b5cb(0x134)](),_0x1dc35d=this;return[0x4,docker[_0xb4b5cb(0x188)](this[_0xb4b5cb(0x125)],this[_0xb4b5cb(0x13c)],this['nasConfig'],this[_0xb4b5cb(0x154)]||path[_0xb4b5cb(0x11e)](this[_0xb4b5cb(0x125)],devs_1[_0xb4b5cb(0x15a)]))];case 0x2:_0x1dc35d['nasMounts']=_0x5b2c62[_0xb4b5cb(0x134)](),_0xb13baf=this;return[0x4,processZipCodeIfNecessary(this[_0xb4b5cb(0x150)])];case 0x3:_0xb13baf[_0xb4b5cb(0x121)]=_0x5b2c62[_0xb4b5cb(0x134)](),_0xef5fad=this;return[0x4,docker[_0xb4b5cb(0x123)](this[_0xb4b5cb(0x121)]||this['codeUri'])];case 0x4:_0xef5fad[_0xb4b5cb(0x137)]=_0x5b2c62['sent'](),_0x3e4bc4=this;if(!(!process[_0xb4b5cb(0x12f)][_0xb4b5cb(0x186)]||utils_1[_0xb4b5cb(0x15c)](process['env'][_0xb4b5cb(0x186)])))return[0x3,0x6];return[0x4,docker[_0xb4b5cb(0x176)](this['tmpDir'])];case 0x5:_0x15e274=_0x5b2c62['sent']();return[0x3,0x7];case 0x6:_0x15e274=null,_0x5b2c62[_0xb4b5cb(0x147)]=0x7;case 0x7:_0x3e4bc4[_0xb4b5cb(0x129)]=_0x15e274,_0x58c159=this;return[0x4,docker[_0xb4b5cb(0x17d)](this[_0xb4b5cb(0x139)])];case 0x8:_0x58c159[_0xb4b5cb(0x17c)]=_0x5b2c62['sent'](),_0x596a72=this;return[0x4,docker[_0xb4b5cb(0x146)]()];case 0x9:_0x596a72[_0xb4b5cb(0x124)]=_0x5b2c62['sent'](),_0x27b295=_[_0xb4b5cb(0x120)](__spreadArrays([this[_0xb4b5cb(0x137)]],this[_0xb4b5cb(0x167)],[this['passwdMount']]));!_['isEmpty'](this['tmpDirMount'])&&_0x27b295[_0xb4b5cb(0x152)](this[_0xb4b5cb(0x129)]);!_[_0xb4b5cb(0x162)](this[_0xb4b5cb(0x17c)])&&_0x27b295[_0xb4b5cb(0x152)](this[_0xb4b5cb(0x17c)]);return[0x4,docker[_0xb4b5cb(0x159)]()];case 0xa:_0x3b3ae3=_0x5b2c62[_0xb4b5cb(0x134)]();_0x3b3ae3?this[_0xb4b5cb(0x13e)]=dockerOpts[_0xb4b5cb(0x155)](_0x27b295):this[_0xb4b5cb(0x13e)]=_0x27b295;logger_1[_0xb4b5cb(0x18d)][_0xb4b5cb(0x15e)](_0xb4b5cb(0x144)+JSON['stringify'](this[_0xb4b5cb(0x13e)],null,0x4)),this['containerName']=docker[_0xb4b5cb(0x170)](),_0xc15bf7=runtime_1[_0xb4b5cb(0x189)](this['runtime']);if(!_0xc15bf7)return[0x3,0xb];this[_0xb4b5cb(0x12a)]=this[_0xb4b5cb(0x145)][_0xb4b5cb(0x16c)][_0xb4b5cb(0x184)];return[0x3,0xd];case 0xb:_0x4abf0e=this;return[0x4,dockerOpts[_0xb4b5cb(0x185)](this[_0xb4b5cb(0x133)])];case 0xc:_0x4abf0e['imageName']=_0x5b2c62[_0xb4b5cb(0x134)](),_0x5b2c62[_0xb4b5cb(0x147)]=0xd;case 0xd:return[0x4,docker['pullFcImageIfNeed'](this[_0xb4b5cb(0x12a)])];case 0xe:_0x5b2c62[_0xb4b5cb(0x134)](),this[_0xb4b5cb(0x122)]=!![];return[0x2];}});});},_0x25a239[_0x4afe7a(0x14a)][_0x4afe7a(0x141)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x49d681){return[0x2];});});},_0x25a239['prototype'][_0x4afe7a(0x172)]=function(){var _0x2c2001,_0x1ba67a;return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0xd345fa){var _0x5f95a6=a32_0x2612;switch(_0xd345fa['label']){case 0x0:if(!(this[_0x5f95a6(0x12c)]&&this['debugIde']))return[0x3,0x4];if(!(this[_0x5f95a6(0x13a)][_0x5f95a6(0x190)]()===_0x5f95a6(0x164)))return[0x3,0x2];return[0x4,docker_1[_0x5f95a6(0x143)](this['baseDir'],this['serviceName'],this[_0x5f95a6(0x18c)],this[_0x5f95a6(0x133)],((_0x2c2001=this[_0x5f95a6(0x145)])===null||_0x2c2001===void 0x0?void 0x0:_0x2c2001[_0x5f95a6(0x14b)])?path['join'](this['baseDir'],this['functionConfig'][_0x5f95a6(0x14b)]):null,this[_0x5f95a6(0x12c)])];case 0x1:_0xd345fa[_0x5f95a6(0x134)]();return[0x3,0x4];case 0x2:if(!(this[_0x5f95a6(0x13a)]['toLowerCase']()===_0x5f95a6(0x15b)))return[0x3,0x4];return[0x4,docker['showDebugIdeTipsForPycharm'](((_0x1ba67a=this[_0x5f95a6(0x145)])===null||_0x1ba67a===void 0x0?void 0x0:_0x1ba67a[_0x5f95a6(0x14b)])?path[_0x5f95a6(0x11e)](this[_0x5f95a6(0x125)],this['functionConfig'][_0x5f95a6(0x14b)]):null,this['debugPort'])];case 0x3:_0xd345fa['sent'](),_0xd345fa['label']=0x4;case 0x4:return[0x2];}});});},_0x25a239[_0x4afe7a(0x14a)][_0x4afe7a(0x16b)]=function(){var _0xafe53b=_0x4afe7a;this[_0xafe53b(0x121)]&&(rimraf[_0xafe53b(0x180)](this[_0xafe53b(0x121)]),console['log']('clean\x20tmp\x20code\x20dir\x20'+this[_0xafe53b(0x121)]+_0xafe53b(0x168)),this['unzippedCodeDir']=null);},_0x25a239[_0x4afe7a(0x14a)][_0x4afe7a(0x135)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x2ed723){return this['cleanUnzippedCodeDir'](),[0x2];});});},_0x25a239;}();exports['default']=Invoke;