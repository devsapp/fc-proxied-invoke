'use strict';var a32_0x2555=['tunnelService','../../docker/docker-opts','name','tmpDir','../../../common/logger','sent','label','functionConfig','../../devs','\x20successfully','sessionId','default','codeMount','pop','serviceName','__spreadArrays','containerName','704597dfFUNn','trys','pycharm','docker\x20mounts:\x20','__createBinding','showDebugIdeTipsForPycharm','next','inited','passwdMount','transformMountsForToolbox','uuid','then','1000357AIpNWS','toLowerCase','stringify','.war','log','__generator','1113754fdikhJ','call','init','lodash','265567ibXtAC','baseDir','619phHcif','setDebugIdeConfig','isDockerToolBoxAndEnsureDockerVersion','debuggerPath','compact','debug','2gGyBpZ','isEmpty','resolveCodeUriToMount','unzippedCodeDir','fs-extra','isCustomContainerRuntime','temp-dir','resolvePasswdMount','creds','prototype','Generator\x20is\x20already\x20executing.','codeUri','nasBaseDir','function','sync','ops','debugIde','765435TOLaqU','value','clean\x20tmp\x20code\x20dir\x20','.jar','852759FexmMc','serviceConfig','1196cSBeIR','1GQRPJh','cleanUnzippedCodeDir','push','mounts','imageName','create','debuggerMount','apply','functionName','return','DEFAULT_NAS_PATH_SUFFIX','debugPort','pullFcImageIfNeed','tmpDirMount','resolveDebuggerPathToMount','defineProperty','ensureDir','region','__esModule','throw','nasConfig','iterator','beforeInvoke','length','hasOwnProperty','__importStar','vscode','endsWith','resolveRuntimeToDockerImage','1gdOmRj','runtime','../../utils/runtime','path','__awaiter','resolveNasConfigToMounts','../../docker/docker','nasMounts'];function a32_0x5618(_0xc263d,_0x201abf){return a32_0x5618=function(_0x2555b2,_0x561885){_0x2555b2=_0x2555b2-0x142;var _0x5eab14=a32_0x2555[_0x2555b2];return _0x5eab14;},a32_0x5618(_0xc263d,_0x201abf);}var a32_0x34ad89=a32_0x5618;(function(_0xc2b9fd,_0x5c662e){var _0x430262=a32_0x5618;while(!![]){try{var _0x20f628=parseInt(_0x430262(0x143))*-parseInt(_0x430262(0x168))+parseInt(_0x430262(0x172))*parseInt(_0x430262(0x17a))+parseInt(_0x430262(0x16e))+parseInt(_0x430262(0x191))*parseInt(_0x430262(0x174))+-parseInt(_0x430262(0x18f))+parseInt(_0x430262(0x15c))*-parseInt(_0x430262(0x192))+parseInt(_0x430262(0x18b));if(_0x20f628===_0x5c662e)break;else _0xc2b9fd['push'](_0xc2b9fd['shift']());}catch(_0x3563e3){_0xc2b9fd['push'](_0xc2b9fd['shift']());}}}(a32_0x2555,0x90c26));var __createBinding=this&&this[a32_0x34ad89(0x160)]||(Object['create']?function(_0x331056,_0x567959,_0x1c744a,_0x1b8ae4){var _0x4c6c93=a32_0x34ad89;if(_0x1b8ae4===undefined)_0x1b8ae4=_0x1c744a;Object[_0x4c6c93(0x1a1)](_0x331056,_0x1b8ae4,{'enumerable':!![],'get':function(){return _0x567959[_0x1c744a];}});}:function(_0x36af16,_0x21d75d,_0x550be9,_0x18a52d){if(_0x18a52d===undefined)_0x18a52d=_0x550be9;_0x36af16[_0x18a52d]=_0x21d75d[_0x550be9];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object[a32_0x34ad89(0x197)]?function(_0x3fdf68,_0x282040){var _0x5bf25f=a32_0x34ad89;Object[_0x5bf25f(0x1a1)](_0x3fdf68,_0x5bf25f(0x156),{'enumerable':!![],'value':_0x282040});}:function(_0x34033f,_0x52112b){var _0x7d8508=a32_0x34ad89;_0x34033f[_0x7d8508(0x156)]=_0x52112b;}),__importStar=this&&this[a32_0x34ad89(0x1ab)]||function(_0xcd4a45){var _0x57c9b6=a32_0x34ad89;if(_0xcd4a45&&_0xcd4a45[_0x57c9b6(0x1a4)])return _0xcd4a45;var _0x3ae012={};if(_0xcd4a45!=null){for(var _0x17c270 in _0xcd4a45)if(_0x17c270!==_0x57c9b6(0x156)&&Object[_0x57c9b6(0x1aa)][_0x57c9b6(0x16f)](_0xcd4a45,_0x17c270))__createBinding(_0x3ae012,_0xcd4a45,_0x17c270);}return __setModuleDefault(_0x3ae012,_0xcd4a45),_0x3ae012;},__awaiter=this&&this[a32_0x34ad89(0x147)]||function(_0x6e9ebc,_0x11b631,_0x36cbc0,_0x342196){function _0x38f064(_0x31b37a){return _0x31b37a instanceof _0x36cbc0?_0x31b37a:new _0x36cbc0(function(_0x397c64){_0x397c64(_0x31b37a);});}return new(_0x36cbc0||(_0x36cbc0=Promise))(function(_0x28f793,_0x34a010){var _0x334a25=a32_0x5618;function _0x20ae72(_0x3d52cb){var _0x1619d1=a32_0x5618;try{_0x4128dc(_0x342196[_0x1619d1(0x162)](_0x3d52cb));}catch(_0x42f5b6){_0x34a010(_0x42f5b6);}}function _0x833245(_0x38cda2){var _0x1cc5bb=a32_0x5618;try{_0x4128dc(_0x342196[_0x1cc5bb(0x1a5)](_0x38cda2));}catch(_0xe7fb5){_0x34a010(_0xe7fb5);}}function _0x4128dc(_0x876846){var _0x34ea3=a32_0x5618;_0x876846['done']?_0x28f793(_0x876846[_0x34ea3(0x18c)]):_0x38f064(_0x876846[_0x34ea3(0x18c)])[_0x34ea3(0x167)](_0x20ae72,_0x833245);}_0x4128dc((_0x342196=_0x342196[_0x334a25(0x199)](_0x6e9ebc,_0x11b631||[]))[_0x334a25(0x162)]());});},__generator=this&&this[a32_0x34ad89(0x16d)]||function(_0x45f0d0,_0x2973df){var _0x1d69e4=a32_0x34ad89,_0x4d61b4={'label':0x0,'sent':function(){if(_0x7f2a05[0x0]&0x1)throw _0x7f2a05[0x1];return _0x7f2a05[0x1];},'trys':[],'ops':[]},_0x48c800,_0x4731c8,_0x7f2a05,_0x455a63;return _0x455a63={'next':_0x11c3ef(0x0),'throw':_0x11c3ef(0x1),'return':_0x11c3ef(0x2)},typeof Symbol===_0x1d69e4(0x187)&&(_0x455a63[Symbol[_0x1d69e4(0x1a7)]]=function(){return this;}),_0x455a63;function _0x11c3ef(_0x114ee8){return function(_0x20889d){return _0x12fda4([_0x114ee8,_0x20889d]);};}function _0x12fda4(_0x37e2ab){var _0x85b5ae=_0x1d69e4;if(_0x48c800)throw new TypeError(_0x85b5ae(0x184));while(_0x4d61b4)try{if(_0x48c800=0x1,_0x4731c8&&(_0x7f2a05=_0x37e2ab[0x0]&0x2?_0x4731c8['return']:_0x37e2ab[0x0]?_0x4731c8[_0x85b5ae(0x1a5)]||((_0x7f2a05=_0x4731c8[_0x85b5ae(0x19b)])&&_0x7f2a05[_0x85b5ae(0x16f)](_0x4731c8),0x0):_0x4731c8[_0x85b5ae(0x162)])&&!(_0x7f2a05=_0x7f2a05['call'](_0x4731c8,_0x37e2ab[0x1]))['done'])return _0x7f2a05;if(_0x4731c8=0x0,_0x7f2a05)_0x37e2ab=[_0x37e2ab[0x0]&0x2,_0x7f2a05[_0x85b5ae(0x18c)]];switch(_0x37e2ab[0x0]){case 0x0:case 0x1:_0x7f2a05=_0x37e2ab;break;case 0x4:_0x4d61b4[_0x85b5ae(0x151)]++;return{'value':_0x37e2ab[0x1],'done':![]};case 0x5:_0x4d61b4[_0x85b5ae(0x151)]++,_0x4731c8=_0x37e2ab[0x1],_0x37e2ab=[0x0];continue;case 0x7:_0x37e2ab=_0x4d61b4[_0x85b5ae(0x189)][_0x85b5ae(0x158)](),_0x4d61b4['trys']['pop']();continue;default:if(!(_0x7f2a05=_0x4d61b4['trys'],_0x7f2a05=_0x7f2a05['length']>0x0&&_0x7f2a05[_0x7f2a05[_0x85b5ae(0x1a9)]-0x1])&&(_0x37e2ab[0x0]===0x6||_0x37e2ab[0x0]===0x2)){_0x4d61b4=0x0;continue;}if(_0x37e2ab[0x0]===0x3&&(!_0x7f2a05||_0x37e2ab[0x1]>_0x7f2a05[0x0]&&_0x37e2ab[0x1]<_0x7f2a05[0x3])){_0x4d61b4[_0x85b5ae(0x151)]=_0x37e2ab[0x1];break;}if(_0x37e2ab[0x0]===0x6&&_0x4d61b4[_0x85b5ae(0x151)]<_0x7f2a05[0x1]){_0x4d61b4[_0x85b5ae(0x151)]=_0x7f2a05[0x1],_0x7f2a05=_0x37e2ab;break;}if(_0x7f2a05&&_0x4d61b4['label']<_0x7f2a05[0x2]){_0x4d61b4[_0x85b5ae(0x151)]=_0x7f2a05[0x2],_0x4d61b4['ops'][_0x85b5ae(0x194)](_0x37e2ab);break;}if(_0x7f2a05[0x2])_0x4d61b4[_0x85b5ae(0x189)][_0x85b5ae(0x158)]();_0x4d61b4[_0x85b5ae(0x15d)][_0x85b5ae(0x158)]();continue;}_0x37e2ab=_0x2973df['call'](_0x45f0d0,_0x4d61b4);}catch(_0x2de947){_0x37e2ab=[0x6,_0x2de947],_0x4731c8=0x0;}finally{_0x48c800=_0x7f2a05=0x0;}if(_0x37e2ab[0x0]&0x5)throw _0x37e2ab[0x1];return{'value':_0x37e2ab[0x0]?_0x37e2ab[0x1]:void 0x0,'done':!![]};}},__spreadArrays=this&&this[a32_0x34ad89(0x15a)]||function(){var _0xfebc66=a32_0x34ad89;for(var _0x314f88=0x0,_0x1b7515=0x0,_0x4367f4=arguments['length'];_0x1b7515<_0x4367f4;_0x1b7515++)_0x314f88+=arguments[_0x1b7515][_0xfebc66(0x1a9)];for(var _0x4a3251=Array(_0x314f88),_0x154c41=0x0,_0x1b7515=0x0;_0x1b7515<_0x4367f4;_0x1b7515++)for(var _0x4f74d0=arguments[_0x1b7515],_0x59d90f=0x0,_0x4e5c8d=_0x4f74d0['length'];_0x59d90f<_0x4e5c8d;_0x59d90f++,_0x154c41++)_0x4a3251[_0x154c41]=_0x4f74d0[_0x59d90f];return _0x4a3251;},__importDefault=this&&this['__importDefault']||function(_0x4e4853){var _0xe7830d=a32_0x34ad89;return _0x4e4853&&_0x4e4853[_0xe7830d(0x1a4)]?_0x4e4853:{'default':_0x4e4853};};Object[a32_0x34ad89(0x1a1)](exports,a32_0x34ad89(0x1a4),{'value':!![]});var path=__importStar(require(a32_0x34ad89(0x146))),_=__importStar(require(a32_0x34ad89(0x171))),docker=__importStar(require('../../docker/docker')),logger_1=__importDefault(require(a32_0x34ad89(0x14f))),dockerOpts=__importStar(require(a32_0x34ad89(0x14c))),fs=__importStar(require(a32_0x34ad89(0x17e))),uuid_1=require(a32_0x34ad89(0x166)),rimraf=__importStar(require('rimraf')),extract_zip_1=__importDefault(require('extract-zip')),tmpDir=__importStar(require(a32_0x34ad89(0x180))),devs_1=require(a32_0x34ad89(0x153)),runtime_1=require(a32_0x34ad89(0x145)),docker_1=require(a32_0x34ad89(0x149));function isZipArchive(_0x11afe3){var _0x4417bf=a32_0x34ad89;return _0x11afe3?_0x11afe3[_0x4417bf(0x1ad)]('.zip')||_0x11afe3['endsWith'](_0x4417bf(0x18e))||_0x11afe3[_0x4417bf(0x1ad)](_0x4417bf(0x16b)):![];}function processZipCodeIfNecessary(_0x48b802){return __awaiter(this,void 0x0,void 0x0,function(){var _0x343706;return __generator(this,function(_0x5cccd2){var _0x5bc155=a32_0x5618;switch(_0x5cccd2[_0x5bc155(0x151)]){case 0x0:if(!isZipArchive(_0x48b802))return[0x2,null];_0x343706=path['join'](tmpDir,uuid_1['v4']());return[0x4,fs[_0x5bc155(0x1a2)](_0x343706)];case 0x1:_0x5cccd2[_0x5bc155(0x150)](),logger_1[_0x5bc155(0x156)][_0x5bc155(0x16c)]('codeUri\x20is\x20a\x20zip\x20format,\x20will\x20unzipping\x20to\x20'+_0x343706);return[0x4,extract_zip_1[_0x5bc155(0x156)](_0x48b802,{'dir':_0x343706})];case 0x2:_0x5cccd2[_0x5bc155(0x150)]();return[0x2,_0x343706];}});});}var Invoke=function(){var _0x29c011=a32_0x34ad89;function _0x4c1a49(_0x38f803,_0x311cb9,_0x1217e0,_0x166d34,_0x4f3acb,_0x311c09,_0x34a8f5,_0x12257b,_0x9e48f6,_0x48739c,_0x18162b,_0x457da4,_0x2a790e,_0x24c21e){var _0x118a67=a32_0x5618;this[_0x118a67(0x14b)]=_0x38f803,this[_0x118a67(0x155)]=_0x311cb9,this[_0x118a67(0x182)]=_0x1217e0,this[_0x118a67(0x1a3)]=_0x166d34,this['serviceName']=_0x311c09[_0x118a67(0x14d)],this[_0x118a67(0x190)]=_0x311c09,this['functionName']=_0x34a8f5[_0x118a67(0x14d)],this['functionConfig']=_0x34a8f5,this['triggerConfig']=_0x12257b,this[_0x118a67(0x19d)]=_0x9e48f6,this[_0x118a67(0x18a)]=_0x48739c,this['nasBaseDir']=_0x24c21e,this['runtime']=this[_0x118a67(0x152)][_0x118a67(0x144)],this[_0x118a67(0x173)]=_0x4f3acb,this[_0x118a67(0x185)]=this[_0x118a67(0x152)][_0x118a67(0x185)]?path['resolve'](this['baseDir'],this[_0x118a67(0x152)][_0x118a67(0x185)]):null,this['tmpDir']=_0x18162b,this[_0x118a67(0x177)]=_0x457da4,this['debugArgs']=_0x2a790e;}return _0x4c1a49[_0x29c011(0x183)][_0x29c011(0x170)]=function(){var _0x39599e;return __awaiter(this,void 0x0,void 0x0,function(){var _0x4c29ab,_0x157328,_0x16bfe6,_0x40ebda,_0x169408,_0x43fb41,_0x37b85f,_0x1efe27,_0x4e361d,_0x4cf198,_0x211dfd;return __generator(this,function(_0x53d8f6){var _0x3ac5a0=a32_0x5618;switch(_0x53d8f6[_0x3ac5a0(0x151)]){case 0x0:this[_0x3ac5a0(0x1a6)]=(_0x39599e=this[_0x3ac5a0(0x190)])===null||_0x39599e===void 0x0?void 0x0:_0x39599e[_0x3ac5a0(0x1a6)],_0x4c29ab=this;return[0x4,dockerOpts['resolveDockerUser']({'nasConfig':this[_0x3ac5a0(0x1a6)]})];case 0x1:_0x4c29ab['dockerUser']=_0x53d8f6['sent'](),_0x157328=this;return[0x4,docker[_0x3ac5a0(0x148)](this['baseDir'],this['serviceName'],this[_0x3ac5a0(0x1a6)],this[_0x3ac5a0(0x186)]||path['join'](this[_0x3ac5a0(0x173)],devs_1[_0x3ac5a0(0x19c)]))];case 0x2:_0x157328[_0x3ac5a0(0x14a)]=_0x53d8f6[_0x3ac5a0(0x150)](),_0x16bfe6=this;return[0x4,processZipCodeIfNecessary(this['codeUri'])];case 0x3:_0x16bfe6[_0x3ac5a0(0x17d)]=_0x53d8f6[_0x3ac5a0(0x150)](),_0x40ebda=this;return[0x4,docker[_0x3ac5a0(0x17c)](this[_0x3ac5a0(0x17d)]||this['codeUri'])];case 0x4:_0x40ebda['codeMount']=_0x53d8f6['sent'](),_0x169408=this;return[0x4,docker['resolveTmpDirToMount'](this[_0x3ac5a0(0x14e)])];case 0x5:_0x169408[_0x3ac5a0(0x19f)]=_0x53d8f6[_0x3ac5a0(0x150)](),_0x43fb41=this;return[0x4,docker[_0x3ac5a0(0x1a0)](this[_0x3ac5a0(0x177)])];case 0x6:_0x43fb41[_0x3ac5a0(0x198)]=_0x53d8f6['sent'](),_0x37b85f=this;return[0x4,docker[_0x3ac5a0(0x181)]()];case 0x7:_0x37b85f[_0x3ac5a0(0x164)]=_0x53d8f6[_0x3ac5a0(0x150)](),_0x1efe27=_[_0x3ac5a0(0x178)](__spreadArrays([this[_0x3ac5a0(0x157)]],this['nasMounts'],[this['passwdMount']]));!_[_0x3ac5a0(0x17b)](this[_0x3ac5a0(0x19f)])&&_0x1efe27[_0x3ac5a0(0x194)](this[_0x3ac5a0(0x19f)]);!_['isEmpty'](this[_0x3ac5a0(0x198)])&&_0x1efe27['push'](this['debuggerMount']);return[0x4,docker[_0x3ac5a0(0x176)]()];case 0x8:_0x4e361d=_0x53d8f6['sent']();_0x4e361d?this['mounts']=dockerOpts[_0x3ac5a0(0x165)](_0x1efe27):this['mounts']=_0x1efe27;logger_1[_0x3ac5a0(0x156)][_0x3ac5a0(0x179)](_0x3ac5a0(0x15f)+JSON[_0x3ac5a0(0x16a)](this[_0x3ac5a0(0x195)],null,0x4)),this[_0x3ac5a0(0x15b)]=docker['generateRamdomContainerName'](),_0x4cf198=runtime_1[_0x3ac5a0(0x17f)](this['runtime']);if(!_0x4cf198)return[0x3,0x9];this[_0x3ac5a0(0x196)]=this['functionConfig']['customContainerConfig']['image'];return[0x3,0xb];case 0x9:_0x211dfd=this;return[0x4,dockerOpts[_0x3ac5a0(0x142)](this[_0x3ac5a0(0x144)])];case 0xa:_0x211dfd['imageName']=_0x53d8f6[_0x3ac5a0(0x150)](),_0x53d8f6['label']=0xb;case 0xb:return[0x4,docker[_0x3ac5a0(0x19e)](this['imageName'])];case 0xc:_0x53d8f6[_0x3ac5a0(0x150)](),this[_0x3ac5a0(0x163)]=!![];return[0x2];}});});},_0x4c1a49[_0x29c011(0x183)][_0x29c011(0x1a8)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x4d26d3){return[0x2];});});},_0x4c1a49['prototype']['showDebugIdeTips']=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x28e1f9){var _0x50b707=a32_0x5618;switch(_0x28e1f9[_0x50b707(0x151)]){case 0x0:if(!(this[_0x50b707(0x19d)]&&this['debugIde']))return[0x3,0x4];if(!(this[_0x50b707(0x18a)]['toLowerCase']()===_0x50b707(0x1ac)))return[0x3,0x2];return[0x4,docker['showDebugIdeTipsForVscode'](this['serviceName'],this['functionName'],this[_0x50b707(0x144)],this[_0x50b707(0x157)]['Source'],this[_0x50b707(0x19d)])];case 0x1:_0x28e1f9[_0x50b707(0x150)]();return[0x3,0x4];case 0x2:if(!(this[_0x50b707(0x18a)]['toLowerCase']()===_0x50b707(0x15e)))return[0x3,0x4];return[0x4,docker[_0x50b707(0x161)](this[_0x50b707(0x157)]['Source'],this[_0x50b707(0x19d)])];case 0x3:_0x28e1f9['sent'](),_0x28e1f9[_0x50b707(0x151)]=0x4;case 0x4:return[0x2];}});});},_0x4c1a49['prototype'][_0x29c011(0x175)]=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x30d06f){var _0xec32f4=a32_0x5618;switch(_0x30d06f[_0xec32f4(0x151)]){case 0x0:if(!(this[_0xec32f4(0x19d)]&&this[_0xec32f4(0x18a)]))return[0x3,0x2];if(!(this[_0xec32f4(0x18a)][_0xec32f4(0x169)]()===_0xec32f4(0x1ac)))return[0x3,0x2];return[0x4,docker_1['writeDebugIdeConfigForVscode'](this[_0xec32f4(0x173)],this[_0xec32f4(0x159)],this[_0xec32f4(0x19a)],this[_0xec32f4(0x144)],this[_0xec32f4(0x157)]['Source'],this[_0xec32f4(0x19d)])];case 0x1:_0x30d06f['sent'](),_0x30d06f['label']=0x2;case 0x2:return[0x2];}});});},_0x4c1a49['prototype'][_0x29c011(0x193)]=function(){var _0x2f79b7=_0x29c011;this[_0x2f79b7(0x17d)]&&(rimraf[_0x2f79b7(0x188)](this[_0x2f79b7(0x17d)]),console[_0x2f79b7(0x16c)](_0x2f79b7(0x18d)+this[_0x2f79b7(0x17d)]+_0x2f79b7(0x154)),this['unzippedCodeDir']=null);},_0x4c1a49['prototype']['afterInvoke']=function(){return __awaiter(this,void 0x0,void 0x0,function(){return __generator(this,function(_0x426e2e){var _0x492e17=a32_0x5618;return this[_0x492e17(0x193)](),[0x2];});});},_0x4c1a49;}();exports['default']=Invoke;